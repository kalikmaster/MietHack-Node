<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title1</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body{
            color: var(--tg-theme-text-color);
            background: var(--tg-theme-bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 18px;
        }

        textarea {
            resize: vertical;
            width: 100%;
            box-sizing: border-box;
        }

        .hint{
            color: var(--tg-theme-hint-color);
        }

        .link{
            color: var(--tg-theme-link-color);
        }

        .button{
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            font-size: 18px;
        }

        .button:not(:last-child){
            margin-bottom: 20px
        }
    </style>
</head>
<body id="body">
<form>
    <% form.forEach(function(field) { %>
        <% if (field.field_type == 'checkbox') { %>
            <fieldset>
                <legend><%= field.field_name %></legend>
                <% Object.values(field.field_values).forEach(function(box) { %>
                    <input type='checkbox' name='<%= field.field_id %>'><%= box %><br>
                <% }) %>
            </fieldset>
        <% } %>
        <% if (field.field_type == 'radiobox') { %>
            <fieldset>
                <legend><%= field.field_name %></legend>
                <% Object.values(field.field_values).forEach(function(box) { %>
                    <input type='radio' name='<%= field.field_id %>'><%= box %><br>
                <% }) %>
            </fieldset>
        <% } %>
        <% if (field.field_type == 'text') { %>
                <%= field.field_name %>
                <textarea name='<%= field.field_id %>' oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"'></textarea>
            <br>
        <% } %>
        <% if (field.field_type == 'file') { %>
            <label><%= field.field_name %><input type="file" name='<%= field.field_id %>'></label>
            <br>
        <% } %>
        <br>
    <% }); %>
</form>
<script>
    let tg = Telegram.WebApp; //получаем объект webapp телеграма
    tg.initData
    initData = tg.initData.split('&')
    initDataDict = {}
    initData.forEach(function (value) {
        var index = value.indexOf('=')
        var key1 = value.substr(0, index)
        var val1 = value.substr(index + 1)
        initDataDict[key1] = val1
    })
    sorted = Object.keys(initDataDict).sort().reduce(
        (obj, key) => {
            obj[key] = initDataDict[key];
            return obj;
        },
        {}
    );
    hash = sorted['hash']
    delete sorted['hash']
    data_str = ''
    for (const [key, value] of Object.entries(sorted)) {
        data_str += key + '=' + value + '\n'
    }
    data_str.slice(0, -1)
    data = {
        data_check_string: data_str,
        hash: hash
    }
    fetch('https://f5uhuv.deta.dev/validate', {
        method: "POST",
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    }).then(val => val.text()).then(val_text => {
            document.getElementById("body").innerHTML+=data_str
        }).catch(e => {
            document.getElementById("body").innerHTML+= e
        })
</script>
</body>
</html>